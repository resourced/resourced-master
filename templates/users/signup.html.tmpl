{{define "content"}}
<div class="container">
  <div class="row">
    <div class="col-sm-6 col-md-4 col-md-offset-4">
      <div class="account-wall">
        <h1 class="text-center">Chillax Master</h1>
        <h4 class="text-center">create an account</h4>

        <form class="form-signup-login form-signup">
          <input name="Email" type="text" class="form-control" placeholder="Email" required autofocus>
          <input name="Password" type="password" class="form-control password" placeholder="Password" required>
          <input name="PasswordAgain" type="password" class="form-control password-again" placeholder="Password Again" required>
          <button class="btn btn-lg btn-primary btn-block" type="submit">Sign Up</button>

          <a href="/login" class="other-form text-center">I have account already</a>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
$('.form-signup').submit(function(event) {
  event.preventDefault();

  var $form = $(this);
  var formData = {};

  $form.serializeArray().map(function(item) {
    formData[item.name] = item.value;
  });

  $.ajax({
    type: "POST",
    url: "/api/users",
    data: JSON.stringify(formData),
    contentType: "application/json; charset=utf-8",
    dataType: "json"
  })
  .done(function(data, textStatus, jqXHR) {
    $.ajax({
      type: "POST",
      url: "/api/users/login",
      data: JSON.stringify(formData),
      contentType: "application/json; charset=utf-8",
      dataType: "json"
    })
    .done(function(data, textStatus, jqXHR) {
      window.location.href = "/";
    })
    .fail(function(jqXHR, textStatus, errorThrown) {
      alert($.parseJSON(jqXHR.responseText).Error);
    });
  })
  .fail(function(jqXHR, textStatus, errorThrown) {
    alert($.parseJSON(jqXHR.responseText).Error);
  });
});
</script>
{{end}}